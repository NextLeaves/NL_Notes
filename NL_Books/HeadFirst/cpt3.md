title: Decorator Pattern
date: 2018/1/5 22:17:35 
tag: pattern

---

* 装饰者模式：动态的将责任添加到对象上；若要扩展对象，装饰比继承来的更加有弹性。

<!--more-->

# 装饰者模式（Decorator Pattern） #

* 星巴兹（StarBuzz）：以快速的扩张而迅速闻名的咖啡连锁店，如果你再街上看到有这家店，那么可能马路对面还有一家一样的店。
* **第一种设计方案：**
	* 最初的设计方案，所有子类继承**Beverage抽象类**
	* 分别实现：
		* Cost()输出此对象的金额
		* Description()描述此类的细节
	* 创建很多个类，把对象当做类来创建，每一种都创建一个类，**类的爆炸，毫无设计思想**
* **第二种设计方案：**
	* 把需要调料的内容加到**Beverage抽象类中**进行计算添加调料内容
	* 子类只是单纯实现**饮料的具体类**，并不存在**调料的具体类**

---

1. 思考：当那些需求和因素改变时会影响项目的设计？

## 大师与门徒 ##

* 领悟内容：
	1. 继承十分强大，但是并不适合所有的复用操作
	2. 利用**组合**和**委托**可以在运行时，达到**继承**的效果（实现新的功能、责任）
	3. **继承**只能在在动态编码中，实现子类功能的扩展；但是**组合和委托**能够在动态的更改对象的行为、责任
		1. 效果：在不改变原代码的情况下，尽可能的减少bug的引入或意外副作用的机会将大幅度减少
		2. 实例：代码应该像晚霞的莲花一样闭合（封闭），像晨曦的莲花一样开放（扩展）。
* **设计原则：**对扩展开放、对修改封闭
	* 我们的目标是让类容易扩展，并且在不改变现有代码的情况下，实现功能的添加；如果我们能够实现，有什么好处？这样的设计更具有弹性，可以应对改变；允许新功能的添加来应对改变的需求。
* **问题：**
	1. 对扩展开放、对修改封闭；二者听起来比较矛盾，设计如何兼顾两者？
	2. 如何将某个东西设计成可以扩展，又禁止修改？
	3. 我如何让每个部分的设计都遵循开放-封闭原则？
	4. 我怎么知道哪些地方的功能更重要？

## 进入装饰者模式 ##

* 所了解的内容：
	* 装饰者需要和被装饰者有相同的超类，保证类型一致
	* 被装饰者可以被多个装饰者修饰，且不影响
	* 装饰者和被装饰者既然具有相同的超类，那么装饰者可以替代被装饰者的行为
	* **装饰者在被委托被装饰者之前或者之后，可以添加自己的行为，来改变此时的状态**
	* 对象可以在任意时候添加装饰，即可以在运行时，动态的来使用你想使用的装饰者来装饰对象

## 定义装饰者模式 ##

* 超类：component
	* 子类：
		* ConcreteComponent被装饰者
		* Decorator装饰者基类
			* ConcreteDecoratorA			
			* ConcreteDecoratorB
			* 保存对被装饰的引用wrappedObj
* 有相同的接口、相同的超类；为的是装饰者能够取代被装饰者
* 不是继承来自超类，而由组合对象得来
* 行为如果不是来自超类，那么就是子类覆盖后的版本
* 利用组合，可以在运行时进行更换对象的状态，行为
* Beverage设置成接口和抽象类的区别
* **问题：**
	1. 如果将代码针对特定种类的具体组件（例如HouseBlend），做一些特别的事情（例如打折），我担心这样的设计是否恰当，因为一旦用装饰者包装起来，那么就会造成类型改变
		* 针对抽象组件类型编程，即针对抽象编程，针对接口编程
	2. 对于某些客户来说，会不会容易不使用最外圈的装饰者呢？比方说：深焙咖啡，添加了摩卡、豆浆、奶泡来装饰，引用到豆浆，但并不是奶泡，这样算出的结果是否就没有奶泡的价格了？
		* 管理更多的对象，容易造成错误
		* 此模式，通常与工厂模式和生成器模式相互搭配使用更佳
	3. 装饰者知道这一串装饰链条的其他装饰者的存在吗？比如：我想getDescription()出现的是，Whip，Double Mocha，而不是Mocha，Whip，Mocha？
		* 可以在装饰者基类中添加**List**来收集装饰者链中的数据，然后输出的时候，进行相应的判断

## 真实世界的装饰者：I/O操作类 ##

* 操作流程：
	* 先有stream保存现有的文件数据
	* 然后使用streamFormatter
	* 然后再进行序列化操作

## 装饰者模式存在的问题 ##

* 产生大量的小类，对于不理解装饰者模式的人来说，不容易理解
* 类型改变的问题，被包装后的被装饰者将发生类型改变
* 对于装饰链的存在问题，并不清楚装饰的内容，相对较复杂
