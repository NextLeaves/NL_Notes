title: Movement And Animation
date: 2017-12-9 13:50:00
tag: unity3d

---

* 场景中添加阴影
* 让摄像机环绕目标
* 线性插值法（Lerp）平滑旋转
* 为跳跃、悬崖、斜坡处理地面监测
* 实现逼真的角色，以及控制动画

<!--more-->

# 创建第三人称游戏（3D game）：玩家移动和动画 #

## 1.调整摄像机位置 ##

* 调整摄像机的摆放设置

### 1.1 导入角色 ###

* **法线（Normals）：**垂直于多边形平面的方向向量；用于告诉计算机，多边形的朝向，用于朝向方向的光照计算
* **T型姿态：**双臂横向伸展，不自然的状态

### 1.2 添加阴影 ###

* **灯光组件**的**属性：**Shadow Type
* 两种处理阴影的方式：
	* 实时渲染（Real-Time）
	* 光照贴图（Lightmapping）：将产生的阴影制作成贴图，安放在在几何体的贴图中，等效的实现光照的效果；
		* **烘焙阴影：**把阴影效果绘制到模型的贴图上面的过程；Unity中该系统称为：**Enlighten**
* **网格组件：**可以决定是否接受阴影
* **Culling Mask：**剔除不需要涉及的内容，实现针对性的效果

### 1.3 摄像机环绕玩家角色 ###

* Quaternion和Euler旋转方式：
	* 前者基于四元数，进行旋转
	* 后者基于三个轴进行旋转，可能出现万向节
* Quaternion类
* GameObject类-transform类成员-LookAt()方法：不管自身的位置，始终朝向对象

---

## 2. 程序“Camera-relative”的移动 ##

* 第一人称中：角色的左边意味着摄像机的左边
* 第三人称中：角色的左边，可能意味着摄像机的右边

### 2.1 旋转角色，朝向移动方向 ###

* 利用摄像机的旋转的值，来进行物体的设置效果
* 先进行摄像机的旋转值的改变，然后进行转换，再进行恢复

### 2.2 朝着方向向前移动 ###

* 使用Character Controller组件，进行移动
* 限制对角线速度，使用Vector3.ClampMagnitude()

## 3. 实现跳跃 ##

### 3.1 实现垂直速度和加速度 ###

* 利用值，来提高y的值，实现跳跃的动作
* 考虑到下降最高速度

### 3.2 修改地面检测处理边缘和斜坡 ###

* 使用光线投射来检测是否接触地面，同时判断碰撞体是否接触
* ControllerColliderHit
* void OnControllerColliderHit(ControllerColliderHit hit)
* 需要碰撞体的碰撞数据，用于判断法线向量，判断移动方向和斜坡的方向
* 需要光线投射信息，用于判断是否有投射到物（地面）

## 4. 设置玩家角色上的动画 ##

* 解释动画的分配方式：
	* 3D模型就是傀儡
	* 动画是傀儡的一些动作信息
	* 动画控制器就是操作傀儡的人
* 动画分为很多种：
	* 骨骼动画(skeletal animation)：用于人物的动作展示
* model属性参数下的rig，可以选择animation type
	* generic
	* legacy
	* humanoid

### 4.1 在导入的模型上定义动画剪辑 ###

* model属性下的Animations的clips，可以拆分动画的种类，同时，对于可循环的动画来说，设置loop time属性，使得动画可以重复播放
* loop pose：使最后一帧和第一帧相互融合

### 4.2 为动画创建动画控制器 ###

* 使用脚本来控制角色移动
* Animator类的使用方式